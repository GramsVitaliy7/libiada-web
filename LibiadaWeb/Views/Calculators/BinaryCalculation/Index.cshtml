@using LibiadaWeb.Helpers
@model dynamic

@{
    ViewBag.Title = "Вычисление бинарных характеристик";
}

<script type="text/javascript">

    var formTable;

    $(document).ready(function () {
        $('input[name="chainId"]').each(function (i, item) {
            $(item).click(GetChainElements);
        });

        formTable = $("table").dataTable({
            aLengthMenu: [[25, 50, 100, -1], [25, 50, 100, "Все"]],
            bJQueryUI: true,
            sPaginationType: "full_numbers"
        });
        
        $('form').submit(function () {
            //сабмитим скрытые отмеченные чекбоксы
            $(formTable.fnGetHiddenNodes()).find('input:checked').attr("hidden", true).appendTo(this);
        });
    });

    function FiltrationSwitch() {
        SwitchVisibility($("#filterDiv")[0]);
    }

    function FrequencySwitch() {
        SwitchVisibility($("#frequencyDiv")[0]);
    }
    
    function OneWordSwitch() {
        SwitchVisibility($("#oneWordDiv")[0]);
    }

    function GetChainElements(event) {
        $.ajax({
            url: "/api/ChainElements/" + event.target.value,
            type: "GET",
            success: function (elements) {
                $("#oneWordDiv")[0].innerHTML = "";
                
                var table = $('<table/>').attr('id', 'elementsTable');
                var header = $('<thead/>').append($('<tr/>').append($('<th/>').text('Элемент')));
                var body = $('<tbody/>');
                
                $(elements).each(function (i, item) {
                    var checkbox = $('<label/>').html(item.Text).prepend($('<input/>').attr('type', "radio").attr('name', 'wordId').attr('value', item.Value));
                    body.append($('<tr/>').append($('<td/>').append(checkbox)));
                });
                
                table.append(header).append(body);
                $("#oneWordDiv").append(table);
                
                formTable = $("#elementsTable").dataTable({
                    bJQueryUI: true,
                    sPaginationType: "full_numbers"
                });
            }
        });
    }

</script>

<h2>Вычисление бинарных характеристик</h2>
@using (Html.BeginForm())
{
    <table>
        <thead>
            <tr>
                <th>
                    Название объекта
                </th>
                <th>
                    Форма записи
                </th>
                <th>
                    Язык
                </th>
            </tr>
        </thead>
        <tbody>
            @{
                List<MvcHtmlString> chainsList = Html.RadioButtonGroup("chainId", (List<SelectListItem>) ViewBag.chainsList);

                for (int i = 0; i < chainsList.Count; i++)
                {
                    <tr>
                        <td>
                            @chainsList[i]
                        </td>
                        <td>
                            @ViewBag.chains[i].notation.name
                        </td>
                        <td>
                            @if(ViewBag.literatureChains[i] != null)
                            {
                                @ViewBag.literatureChains[i].language.name
                            }
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
    <br/>
    @Html.Label("Характеристика:")
    <select name="characteristicId" id="characteristicId">
        @foreach (var option in ViewBag.characteristicsList)
        {
            <option value="@option.Value">@option.Text</option>
        }
    </select>
    <br/>
    @Html.Label("Привязка:")
    <select name="linkUpId">
        @foreach (var option in ViewBag.linkUpsList)
        {
            <option value="@option.Value">@option.Text</option>
        }
    </select>
    <br/>
    <br/>
    @Html.CheckBox("filter", "Фильтрация", new Dictionary<string, object> {{"onclick", "FiltrationSwitch()"}})
    <br/>
    <div id="filterDiv" hidden>
        @Html.Label("Число выводимых зависимостей")
        <input type="number" name="filtersize" id="filtersize" min="1" value="10"/>
    </div>
    <br/>
    @Html.CheckBox("frequency", "Считать зависимости только для Х самых частых элементов", new Dictionary<string, object> {{"onclick", "FrequencySwitch()"}})
    <br/>
    <div id="frequencyDiv" hidden>
        @Html.Label("X:")
        <input type="number" name="frequencyCount" id="frequencyCount" min="1" value="10"/>
    </div>
    <br/>
    @Html.CheckBox("oneWord", "Считать зависимости только для указанного слова", new Dictionary<string, object> {{"onclick", "OneWordSwitch()"}})
    <br/>
    <div id="oneWordDiv" hidden>
        
    </div>
    <br/>
    <input type="submit" value="Вычислить" />
}