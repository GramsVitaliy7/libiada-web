@using LibiadaWeb.Helpers
@model dynamic

@{
    ViewBag.Title = "Вычисление характеристик";
}

<h2>Вычисление характеристик</h2>

<script type="text/javascript">

    var divCounter = 0;

    var formTable;

    $(document).ready(function() {
        formTable = $("table").dataTable({
            aLengthMenu: [[25, 50, 100, -1], [25, 50, 100, "Все"]],
            bJQueryUI: true,
            sPaginationType: "full_numbers"
        });
    
        $('form').submit(function() {
            $(formTable.fnGetHiddenNodes()).find('input:checked').attr("hidden", true).appendTo(this);
        });

        AddCharacteristic();
    });

    function AddCharacteristic() {
        var characteristicTypes = new Array();
        var linkUps = new Array();
        var notations = new Array();
        var languages = new Array();

        @foreach (var option in ViewBag.characteristicsList)
        {
            @:characteristicTypes.push($("<option/>").attr("value", @option.Value).text('@option.Text'));
        }

        @foreach (var option in ViewBag.linkUpsList)
        {
            @:linkUps.push($("<option/>").attr("value", @option.Value).text('@option.Text'));
        }
        
        @foreach (var option in ViewBag.notationsList)
        {
            @:notations.push($("<option/>").attr("value", @option.Value).text('@option.Text'));
        }
        
        @foreach (var option in ViewBag.languagesList)
        {
            @:languages.push($("<option/>").attr("value", @option.Value).text('@option.Text'));
        }

        var characteristicsDiv = CreateCharacteristicsBlock(divCounter, characteristicTypes, linkUps, notations, languages);
        $("#characteristics_list").append(characteristicsDiv);
        divCounter++;
        
        return false;
    }
</script>

@using (Html.BeginForm())
{
    <table>
        <thead>
            <tr>
                <th>
                    Название объекта
                </th>
                <th>
                    Описание
                </th>
                <th>
                    id
                </th>
            </tr>
        </thead>
        <tbody>
            @{
                List<MvcHtmlString> matterCheckBoxes = 
                    Html.CheckBoxGroup("matterIds", (List<SelectListItem>) ViewBag.matterCheckBoxes);

                for (int i = 0; i < matterCheckBoxes.Count; i++)
                {
                    <tr>
                        <td>
                            @matterCheckBoxes[i]
                        </td>
                        <td>
                            @ViewBag.matters[i].description
                        </td>
                        <td>
                            @ViewBag.matters[i].id_in_remote_db
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
    <br/>
    <input type="button" onclick=" AddCharacteristic() " value="Добавить характеристику"/>
    <div id="characteristics_list"></div>
    <br/>
    <br/>
    <input type="submit" value="Вычислить" />
}