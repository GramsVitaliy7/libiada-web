@model LibiadaWeb.chain

@{
    ViewBag.Title = "Цепочки";
}

<h2>Создание цепочки</h2>

@Html.ValidationMessage("Error")

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}

<script>
    var app = angular.module('CreateChain', []);

    app.controller('CreateChainCtrl', ['$scope', 'filterFilter', function($scope, filterFilter) {

        var data = @Html.Raw(Json.Encode(ViewBag.data)) ;
        
        for(var param in data) {
            $scope[param] = data[param];
        }
        
        $scope.localFile = true;

        $scope.language = $scope.languages[0];

        $scope.matter = $scope.matters[0];

        var filterByNature = function() {
            $scope.notation = filterFilter($scope.notations, { Nature: $scope.matter.Nature })[0];
            $scope.pieceType = filterFilter($scope.pieceTypes, { Nature: $scope.matter.Nature })[0];
        };

        filterByNature();

        $scope.$watch('matter.Nature', filterByNature, true);

        $scope.isLiteratureChain = function() {
            return $scope.natureLiterature == $scope.matter.Nature;
        };
    }]);
    
</script>

@using (Html.BeginForm("Create", "Chain", FormMethod.Post, new
    {
        enctype = "multipart/form-data",
        data_ng_app = "CreateChain"
    }))
{
    @Html.ValidationSummary(true)
    <fieldset data-ng-controller="CreateChainCtrl">
        <legend>Цепочка</legend>

        <div class="editor-label">
            @Html.Label("Загружать цепочку из локального файла")
        </div>
        @Html.CheckBox("localFile", new {data_ng_model = "localFile"})
        <br/>
        <input type="file" name="file" id="file" data-ng-show="localFile"/>
        
        <div class="editor-label">
            @Html.LabelFor(model => model.matter_id)
        </div>
        <div class="editor-field">
            @Html.DropDownList("matter_id", new SelectListItem[0], new
                {
                    data_ng_model = "matter",
                    data_ng_options = "m.Text for m in matters"
                })
            @Html.ValidationMessageFor(model => model.matter_id)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.notation_id)
        </div>
        <div class="editor-field">
            @Html.DropDownList("notation_id", new SelectListItem[0], new
                {
                    data_ng_model = "notation",
                    data_ng_options = "n.Text for n in notations | filter:{Nature: matter.Nature}"
                })
            @Html.ValidationMessageFor(model => model.notation_id)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.dissimilar)
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.dissimilar)
            @Html.ValidationMessageFor(model => model.dissimilar)
        </div>
        
        <div class="editor-label">
            @Html.LabelFor(model => model.piece_type_id)
        </div>
        <div class="editor-field">
            @Html.DropDownList("piece_type_id", new SelectListItem[0], new
                {
                    data_ng_model = "pieceType",
                    data_ng_options = "p.Text for p in pieceTypes | filter:{Nature: matter.Nature}"
                })
            @Html.ValidationMessageFor(model => model.piece_type_id)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.remote_db_id)
        </div>
        <div class="editor-field">
            @Html.DropDownList("remote_db_id", new SelectListItem[0], new
                {
                    data_ng_model = "remoteDb", ng_options = "r.Text for r in remoteDbs"
                })
            @Html.ValidationMessageFor(model => model.remote_db_id)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.remote_id)
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.remote_id)
            @Html.ValidationMessageFor(model => model.remote_id)
        </div>

        <div data-ng-show="isLiteratureChain()">
            <div class="editor-label">
                @Html.Label("Язык литературного произведения")
            </div>
            <div class="editor-field">
                @Html.DropDownList("languageId", new SelectListItem[0], new
                    {
                        data_ng_model = "language", ng_options = "l.Text for l in languages"
                    })
            </div>

            <div class="editor-label">
                @Html.Label("Произведение является оригиналом, а не переводом")
            </div>

            @Html.CheckBox("original")
        </div>
        <p>
            <input type="submit" value="Создать" />
        </p>
    </fieldset>
}

<div>
    @Html.ActionLink("Назад к списку", "Index")
</div>
